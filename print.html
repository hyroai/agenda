<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Agenda API &amp; documentation</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Intro</a></li><li class="chapter-item expanded "><a href="setup.html"><strong aria-hidden="true">2.</strong> Setup</a></li><li class="chapter-item expanded "><a href="configuration.html"><strong aria-hidden="true">3.</strong> Configuration basics</a></li><li class="chapter-item expanded "><a href="knowledge.html"><strong aria-hidden="true">4.</strong> Knowledge</a></li><li class="chapter-item expanded "><a href="slots.html"><strong aria-hidden="true">5.</strong> Slots</a></li><li class="chapter-item expanded "><a href="actions.html"><strong aria-hidden="true">6.</strong> Actions</a></li><li class="chapter-item expanded "><a href="debug.html"><strong aria-hidden="true">7.</strong> Debug</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Agenda API &amp; documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="agenda"><a class="header" href="#agenda"><code>Agenda</code></a></h1>
<p><code>Agenda</code> is a declarative specification language for conversations, focused on specifying knowledge and actions, rather than sequential flows or conversation trees.</p>
<p>We imagine a conversational AI framework that is strapped down to the minimum possible requirements - the things you'd have to tell your agent even if it were human.</p>
<p>These requirements would be the bot's actions and knowledge.</p>
<ul>
<li>Actions - what effects can the bot have on the world. This is usually done via API calls. Example: &quot;The bot can order a pizza by calling http://order.com/pizza and has to give a phone, address and pizza size&quot;.</li>
<li>Knowledge - what the bot knows and will be able to let the users interacting with it know. Example: &quot;The bot should know that our opening hours are 2pm to 10pm.&quot;.</li>
</ul>
<p>Given the knowledge and actions, we create a bot that can interact with users, helping them perform actions and enabling access to knowledge. This means non-linear conversations, where the user can context switch without the bot forgetting its state - a stark difference from trying to come up with all the different paths a conversation could take, i.e. a conversation tree.</p>
<p>As much as possible, we try to avoid having the user need to give different formulations and phrasings as we believe NLP has reached a point where this is no longer required.</p>
<p>We optimize on:</p>
<ul>
<li>composability; actions and knowledge can be disabled or enabled and don't interfere with each other</li>
<li>reuse; bots can share a part of their configuration</li>
<li>focus on business logic rather than NLP; no training examples.</li>
</ul>
<h2 id="video-introduction"><a class="header" href="#video-introduction">Video introduction</a></h2>
<p><a href="https://www.youtube.com/watch?v=67BXS5A6WLY"><img src="https://img.youtube.com/vi/67BXS5A6WLY/default.jpg" alt="Here" /></a></p>
<h2 id="target-audience"><a class="header" href="#target-audience">Target audience</a></h2>
<p><code>Agenda</code> is ideal for general purpose developers who want to set up a conversational interface and are not looking to start an NLP research project, or train their own models. The bots produced will communicate by text via a socket run by a python server, so can be embedded in any service in a short time.</p>
<p>That said those who want to leverage existing NLP services (e.g. an intent recognition service) can embed them within the configuration. This would look like this:</p>
<pre><code class="language-yaml"># The service would receive a post request, e.g.`{someKey: &quot;I want pizza&quot;}`
&amp;my-custom-intent-recognizer
remote:
  state-remote: http://localhost:8000/listen-wants-pizza
  needs:
    - key: someKey
      value: incoming_utterance
</code></pre>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>Let's imagine building a bot for pizza place. In terms of conversation trees, there are many options as to how this conversation can go, here are a couple of examples:</p>
<pre><code>👩 hi there
🤖 Would you like to order pizza?
👩 yup
🤖 Alright. Are you vegan?
👩 no I am not
🤖 Cool. What is your name?
👩 Alice
🤖 Got it. How many pies would you like?
👩 2
🤖 Okay. What kind of toppings would you like?
👩 mushrooms
🤖 Cool. What pizza size would you like?
👩 large
🤖 Cool. What is your address?
👩 81 Mill Street Greenville SC
🤖 Got it. What is your phone number?
👩 212 222 2222
🤖 Cool. Thank you Alice! The phone I got is 212 222 2222.
 We are sending you 2 large pizzas with mushrooms to 81 Mill Street Greenville SC.
</code></pre>
<pre><code>👩 Hi!
🤖 Would you like to order pizza?
👩 yes
🤖 Alright. Are you vegan?
👩 nope
🤖 Cool. What is your name?
👩 Alice, my address is 81 Mill Street Greenville SC
🤖 Cool. How many pies would you like?
👩 2 large pizzas with mushrooms
🤖 Cool. What is your phone number?
👩 212 222 2222
🤖 Okay. Thank you Alice! The phone I got is 212 222 2222.
  We are sending you you 2 large pizzas with mushrooms to 81 Mill Street Greenville SC.
</code></pre>
<p>Collecting data or making up transcriptions to cover all the options, even with machine learning is a pretty tedious task, and would be hard to maintain over time.</p>
<p>Instead one would prefer to say what <strong>is needed</strong> to order pizza, alongside the other goals of the conversation.</p>
<pre><code class="language-yaml">actions:
  - say: I'm transferring you to an agent.
    when:
      not: *wants-pizza
  - say: We currently do not sell vegan pizzas.
    when:
      all:
        - *wants-pizza
        - *is-vegan
  - say:
      say-remote: http://localhost:8000/order-pizza
      needs:
        - key: name
          value: *name
        - key: amount_of_pizzas
          value: *amount_of_pizzas
        - key: toppings
          value: *toppings
        - key: size
          value: *size
        - key: address
          value: *address
        - key: phone
          value: *phone
        - key: email
          value: *email
    when:
      all:
        - *wants-pizza
        - not: *is-vegan
</code></pre>
<p>Subsequently we can define how to ask and listen to each one of the needed details.</p>
<pre><code class="language-yaml">slots:
  - &amp;name
    ack: Nice to meet you {value}!
    ask: What is your name?
    type: name
  - &amp;address
    ask: What is your address?
    type: address
  - &amp;phone
    ask: What is your phone number?
    type: phone
  - &amp;email
    ask: What is your email?
    type: email
  - &amp;amount_of_pizzas
    ask: How many pies would you like?
    amount-of: pie
  - &amp;wants-pizza-question
    ask: Would you like to order pizza?
    type: boolean
  - &amp;wants-pizza-intent
    intent:
      - I want to order pizza
      - I want pizza
  - &amp;wants-pizza
    any:
      - *wants-pizza-question
      - *wants-pizza-intent
  - &amp;is-vegan
    ask: Are you vegan?
    type: boolean
  - &amp;toppings
    ask: What kind of toppings would you like?
    multiple-choice:
      - mushrooms
      - olives
      - tomatoes
      - onions
  - &amp;size
    ask: What pizza size would you like?
    choice:
      - small
      - medium
      - large
</code></pre>
<p>Given this spec, agenda will create a bot that can handle the conversations above, and many other variations. <strong>No custom training or data collection is needed</strong>, and if requirements change, all the conversation designer needs to do is change the configuration.</p>
<p>For Joe's pizza place, the actual API that orders the pizza is not a part of the bot code, so it is convenient to do this in an external server for the user to define. This allows combining agenda with any backend coding language, or use multiple backends within the same bot.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup"><a class="header" href="#setup">Setup</a></h1>
<p>You can use <code>agenda</code> on your own machine, or use the version hosted by Hyro at agenda.hyro.ai.</p>
<pre><code class="language-bash">git clone https://github.com/hyroai/agenda.git
pip install -e ./agenda
yarn install --cwd=./config_to_bot/debugger
</code></pre>
<p>In addition run <code>yarn install</code> in each example that you wish to run in <code>config_to_bot/examples</code></p>
<h2 id="issues-with-dependencies"><a class="header" href="#issues-with-dependencies">Issues with dependencies</a></h2>
<ul>
<li><code>spacy</code> requires to run: <code>python -m spacy download en_core_web_sm</code></li>
</ul>
<h2 id="running-pizza-example"><a class="header" href="#running-pizza-example">Running pizza example</a></h2>
<ul>
<li>Running remote functions server:</li>
</ul>
<pre><code class="language-bash">cd ./agenda/config-to-bot/examples/pizza
yarn install
yarn start
</code></pre>
<ul>
<li>Running bot's server: <code>python config_to_bot/main.py</code></li>
<li>Running bot designer:</li>
</ul>
<pre><code class="language-bash">cd ./config_to_bot/debugger
yarn install
yarn start
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration-basics"><a class="header" href="#configuration-basics">Configuration basics</a></h1>
<p><code>Agenda</code> configurations are written in yaml files, the only thing which is nontrivial about yaml files is how variables work. Variable is defined using <code>&amp;</code>, as in <code>&amp;my-variable</code> and are dereferenced using <code>*</code>, e.g. <code>*my-variable</code> (basically a glorified copy paste).</p>
<p>The configuration is built of 3 main parts: <code>actions</code>, <code>knowledge</code> and <code>slots</code>, and an additional part to debugging - <code>debug</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="knowledge"><a class="header" href="#knowledge"><code>knowledge</code></a></h1>
<p>Currently supports questions and answers.</p>
<pre><code class="language-yaml">knowledge:
  - faq:
      - question: What is your opening hours?
        answer: 2pm to 10pm every day.
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="slots"><a class="header" href="#slots"><code>slots</code></a></h1>
<p>If you have a value that is recurring in more than one place, you can factor it out to the <code>slots</code> section.</p>
<pre><code class="language-yaml">slots:
  - &amp;wants-pizza
    ask: Would you like to order pizza?
    type: boolean

actions:
  - say: I can only help with pizza reservations.
    when:
      not: *wants-pizza
  - say: you want pizza!
    when: *wants-pizza
</code></pre>
<h2 id="types-of-slots"><a class="header" href="#types-of-slots">Types of slots</a></h2>
<p>Currently supported types:</p>
<h3 id="person-name"><a class="header" href="#person-name">Person name</a></h3>
<pre><code class="language-yaml">&amp;name
ack: Nice to meet you {}!
ask: What is your name?
type: name
</code></pre>
<h3 id="address"><a class="header" href="#address">Address</a></h3>
<pre><code class="language-yaml">&amp;address
ask: What is your address?
type: address
</code></pre>
<h3 id="phone"><a class="header" href="#phone">Phone</a></h3>
<pre><code class="language-yaml">&amp;phone
ask: What is your phone number?
type: phone
</code></pre>
<h3 id="email"><a class="header" href="#email">Email</a></h3>
<pre><code class="language-yaml">&amp;email
ask: What is your email?
type: email
</code></pre>
<h3 id="amount-of"><a class="header" href="#amount-of">Amount of</a></h3>
<pre><code class="language-yaml">&amp;amount_of_something
ask: How many dogs do you have?
amount-of: dogs
</code></pre>
<h3 id="boolean"><a class="header" href="#boolean">Boolean</a></h3>
<pre><code class="language-yaml">&amp;user-wants-pizza
ask: Would you like to order pizza?
type: boolean
</code></pre>
<h3 id="intent"><a class="header" href="#intent">Intent</a></h3>
<pre><code class="language-yaml">&amp;user-wants-to-complain
intent:
  - I have a complaint
  - I want to complain
</code></pre>
<h3 id="choice"><a class="header" href="#choice">Choice</a></h3>
<pre><code class="language-yaml">&amp;size-of-shirt
ask: What size of t-shirt would you like?
choice:
  - small
  - medium
  - large
</code></pre>
<h4 id="dynamic-choice"><a class="header" href="#dynamic-choice">Dynamic choice</a></h4>
<p>The list of choices can also be dynamically generated by a remote function based on other slots values.</p>
<p>For example:</p>
<pre><code class="language-yaml">&amp;toppings
ask: &quot;Which toppings would you like? you can choose from: {}&quot;
choice:
  state-remote: http://localhost/toppings
  needs:
    - key: is-vegan
      value:
        ask: Are you vegan?
        type: boolean
</code></pre>
<p>The server will be called with a post request with a JSON body containing known items from the <code>needs</code> dictionary.
It must return a JSON string list with possible choices or null to indicate &quot;unknown&quot;.</p>
<h4 id="date-time-choice"><a class="header" href="#date-time-choice">Date time choice</a></h4>
<p>When the choice list consists exclusively of ISO 8601 formatted strings. The bot will try to understand date/time utterances and resolve it to unique choice.</p>
<p>For example for the list: <code>[&quot;2022-04-25T11:00:00&quot;,&quot;2022-04-25T12:00:00&quot;]</code>:</p>
<ul>
<li>if the user says &quot;12 pm&quot; the bot will understand the second option.</li>
<li>if the user says &quot;25th&quot; the bot will ask the user to rephrase because it can not resolve the ambiguity.</li>
</ul>
<h3 id="multiple-choice"><a class="header" href="#multiple-choice">Multiple choice</a></h3>
<pre><code class="language-yaml">&amp;choice-of-toppings
ask: What kind of toppings would you like?
multiple-choice:
  - mushrooms
  - olives
  - tomatoes
  - onions
</code></pre>
<h3 id="compound-slots"><a class="header" href="#compound-slots">Compound slots</a></h3>
<p>Slots can be combined into compound slots via operators.</p>
<p>List of available operators:</p>
<ul>
<li><code>not</code></li>
<li><code>all</code></li>
<li><code>any</code></li>
<li><code>greater_equals</code></li>
<li><code>equals</code></li>
</ul>
<p>For example:</p>
<pre><code class="language-yaml">slots:
  - &amp;age
    ask: What is your age?
    type: number
  - &amp;gender
    ask: What is your gender?
    multiple-choice:
      - male
      - female
      - non binary
  - &amp;male_and_above_18
    all:
      - is: age
        greater_than: 18
      - is: gender
        equals: female
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="actions"><a class="header" href="#actions"><code>actions</code></a></h1>
<p>The <code>actions</code> part lists what the bot can do on behalf of the user. When deciding what to say, the bot will try to match the first relevant action, fulfill its dependencies and performing it, either a saying something or calling a remote API.</p>
<p>Actions might have some dependencies, defined under the <code>needs</code> section.</p>
<p>In addition - it might not make sense to do some things unless some conditions are met. This is what the <code>when</code> section is for.</p>
<p>For example:</p>
<pre><code class="language-yaml">actions:
  - say: I can only help with pizza reservations.
    when:
      not: *wants-pizza
  - say:
      say-remote: http://localhost:8000/order-pizza
      needs:
        - key: toppings
          value:
            ask: What kind of toppings would you like?
            multiple-choice:
              - mushrooms
              - olives
              - tomatoes
              - onions
        - key: size
          value:
            ask: What pizza size would you like?
            choice:
              - small
              - medium
              - large
    when: *wants-pizza

</code></pre>
<p>The remote server will be invoked with an HTTP post and a JSON body. The JSON will contain key-value mapping of known values from the <code>needs</code> definition.
The server should respond with a string, or null to indicate nothing to say.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="debug"><a class="header" href="#debug"><code>debug</code></a></h1>
<p>This part can be used in conjunction with the debugger UI to peek into the bot's state.</p>
<p>When using it you need to label the subgraph you are watching like so:</p>
<pre><code class="language-yaml">debug:
  - key: some-label-for-the-slot-below
    value: *my-slot
  - key: some-other-label
    value: *another-slot
</code></pre>
<p>The result shows the value the bot has in store at that moment of the conversation, alongisde what this part of the bot wants to say (not all parts participate every turn). You'll see a small checkmark if the bot-part has participated in the last turn.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
